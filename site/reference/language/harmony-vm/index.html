<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>The Harmony VM - HarmonyDocs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../../css/theme.css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "The Harmony VM";
    var mkdocs_page_input_path = "reference/language/harmony-vm.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> HarmonyDocs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../..">Overview</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../guides/introduction/">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../../guides/installation/">Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../../guides/running-harmony/">Running a program</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Reference</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Language</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../value-types/">Values</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../statements/">Statements</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../machine-instructions/">Machine Instructions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../contexts-threads/">Contexts and Threads</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">The Harmony VM</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Library</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../library/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../library/alloc/">alloc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../library/bag/">bag</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../library/hoare/">hoare</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../library/list/">list</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../library/set/">set</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../library/synch/">synch</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../textbook/">Textbook</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../changelog/">Changelog</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">HarmonyDocs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Language &raquo;</li>
        
      
        
          <li>Reference &raquo;</li>
        
      
    
    <li>The Harmony VM</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="the-harmony-virtual-machine">The Harmony Virtual Machine</h1>
<p>The Harmony Virtual Machine (HVM) has the following state:</p>
<table>
<thead>
<tr>
<th>State</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>code</code></td>
<td>a list of HVM machine instructions</td>
</tr>
<tr>
<td><code>labels</code></td>
<td>a dictionary of atoms to program counters</td>
</tr>
<tr>
<td><code>variables</code></td>
<td>a dictionary mapping atoms to values</td>
</tr>
<tr>
<td><code>ctxbag</code></td>
<td>a bag of runnable contexts</td>
</tr>
<tr>
<td><code>stopbag</code></td>
<td>a bag of stopped contexts</td>
</tr>
<tr>
<td><code>choosing</code></td>
<td>if not None, indicates a context that is choosing</td>
</tr>
</tbody>
</table>
<p><br />
There is initially a single context with name <code>__init__/()</code> and program counter 0. It starts executing in atomic mode until it finishes executing the last <code>Return</code> instruction. Other threads, created through spawn statements, do not start executing until then.</p>
<p>A <em>step</em> is the execution of a single HVM machine instruction by a context. Each step generates a new state. When there are multiple contexts, the HVM can interleave them. However, trying to interleave every step would be needlessly expensive, as many steps involve changes to a context that are invisible to other contexts.</p>
<p>A <em>stride</em> can involve multiple steps. The following instructions start a new stride: <code>Load</code>, <code>Store</code>, <code>AtomicInc</code>, and <code>Continue</code>. The HVM interleaves stides, not steps. Like steps, each stride involves a single context. Unlike a step, a stride can leave the state unchanged (because its steps lead back to where the stride started).</p>
<p>Executing a Harmony program results in a graph where the nodes are Harmony states and the edges are strides. When a state is <code>choosing</code>, the edges from that state are by a single context, one for each choice. If not, the edges from the state are one per context.</p>
<p>Consecutive strides by the same thread are called a <em>turn</em>. Each state maintains the shortest path to it from the initial state in terms of turns. The diameter of the graph is the length of the longest path found in terms of turns.</p>
<p>If some states have a problem, the state with the shortest path is reported. Problematic states include states that experienced exceptions. If there are no exceptions, Harmony computes the strongly connected components (SCCs) of the graph (the number of such components are printed as part of the output). The sink SCCs should each consist of a terminal state without any threads. If not, again the state with the shortest path is reported.</p>
<p>If there are no problematic states, Harmony reports "no issues found" and outputs in the HTML file the state with the longest path.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../library/overview/" class="btn btn-neutral float-right" title="Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../contexts-threads/" class="btn btn-neutral" title="Contexts and Threads"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../contexts-threads/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../library/overview/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
